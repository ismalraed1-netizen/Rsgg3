<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ±Ø© ØªØµÙ…ÙŠÙ… Ù…Ø§Ø¨Ø§Øª FiveM | Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; }
        .lesson-content h2 { font-size: 1.8rem; font-weight: 800; color: #fca311; margin-bottom: 1rem; }
        .lesson-content h3 { font-size: 1.4rem; font-weight: 700; color: #e5e5e5; margin-top: 1.5rem; margin-bottom: 0.5rem; border-right: 4px solid #fca311; padding-right: 10px; }
        .lesson-content p { line-height: 1.8; color: #d1d5db; margin-bottom: 1rem; }
        .lesson-content ul { list-style-type: disc; margin-right: 1.5rem; color: #d1d5db; margin-bottom: 1rem; }
        .lesson-content li { margin-bottom: 0.5rem; }
        .code-block { direction: ltr; background: #1f2937; padding: 1rem; border-radius: 0.5rem; font-family: monospace; color: #a5f3fc; overflow-x: auto; border: 1px solid #374151; }
        .step-card { background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border: 1px solid rgba(255, 255, 255, 0.1); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #fca311; }
        .active-tab { background-color: #fca311; color: #000; font-weight: bold; }
        
        /* AI Styles */
        .ai-response-area { background-color: #111827; border: 1px solid #374151; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem; min-height: 100px; white-space: pre-wrap; }
        .sparkle-btn { background: linear-gradient(45deg, #fca311, #fbbf24); transition: all 0.3s ease; }
        .sparkle-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(252, 163, 17, 0.5); }
        .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 40% { color: white; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 60% { text-shadow: .25em 0 0 white, .5em 0 0 rgba(0,0,0,0);} 80%, 100% { text-shadow: .25em 0 0 white, .5em 0 0 white;} }
        
        /* Modal */
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-x: hidden; overflow-y: hidden !important; }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Mobile Header -->
    <div class="md:hidden flex justify-between items-center p-4 bg-gray-800 border-b border-gray-700 z-50">
        <h1 class="text-xl font-bold text-yellow-500">FiveM Mapper</h1>
        <button id="menuBtn" class="text-white focus:outline-none">
            <i class="fas fa-bars fa-lg"></i>
        </button>
    </div>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="w-full md:w-1/4 lg:w-1/5 bg-gray-800 border-l border-gray-700 flex-col absolute md:relative h-full z-40 transform translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex">
        <div class="p-6 border-b border-gray-700 hidden md:block">
            <h1 class="text-2xl font-bold text-yellow-500"><i class="fas fa-map-marked-alt ml-2"></i>Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¨Ù†Ø¬</h1>
            <p class="text-xs text-gray-400 mt-1">Ù…Ù† Ø§Ù„ØµÙØ± Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù</p>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-4 space-y-2">
            <!-- Navigation Items will be injected here -->
        </nav>

        <!-- API Key Settings Button -->
        <div class="p-4 border-t border-gray-700">
            <button onclick="toggleModal()" class="w-full bg-gray-700 hover:bg-gray-600 text-gray-200 text-sm py-2 px-4 rounded flex items-center justify-center transition">
                <i class="fas fa-cog ml-2"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            </button>
            <p class="text-xs text-gray-500 text-center mt-2">v3.0 Key Integrated</p>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 bg-gray-900 relative overflow-hidden flex flex-col w-full">
        <div id="contentArea" class="flex-1 overflow-y-auto p-6 md:p-10 max-w-4xl mx-auto w-full">
            <!-- Content will be injected here -->
        </div>
    </main>

    <!-- API Key Modal -->
    <div class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-black opacity-50"></div>
        
        <div class="modal-container bg-gray-800 w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto border border-yellow-500">
            <div class="modal-content py-4 text-right px-6">
                <!-- Title -->
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-yellow-500">Ù…ÙØªØ§Ø­ Ø§Ù„Ø±Ø¨Ø· (API Key)</p>
                    <div class="modal-close cursor-pointer z-50" onclick="toggleModal()">
                        <i class="fas fa-times text-white"></i>
                    </div>
                </div>

                <!-- Body -->
                <p class="text-gray-300 text-sm mb-4">
                    ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¥Ø°Ø§ ØªÙˆÙ‚Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„.
                </p>
                
                <input type="password" id="userApiKey" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white mb-4 focus:border-yellow-500 outline-none" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§">

                <!-- Footer -->
                <div class="flex justify-end pt-2">
                    <button onclick="saveApiKey()" class="px-4 bg-yellow-500 p-3 rounded-lg text-black hover:bg-yellow-400 font-bold">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    <button onclick="clearApiKey()" class="mr-2 px-4 bg-red-600 p-3 rounded-lg text-white hover:bg-red-500 font-bold text-xs">Ø­Ø°Ù Ù…ÙØªØ§Ø­ÙŠ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Logic for API Key Management ---
        // ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ
        const defaultApiKey = "AIzaSyDIZ-c5Br5QSoT3W8LGGy2d5-oISvjyD2w"; 
        
        function getApiKey() {
            // Priority: LocalStorage (User) -> Default (System)
            const storedKey = localStorage.getItem('gemini_api_key');
            return storedKey ? storedKey : defaultApiKey;
        }

        function saveApiKey() {
            const key = document.getElementById('userApiKey').value.trim();
            if(key) {
                localStorage.setItem('gemini_api_key', key);
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­.');
                toggleModal();
            } else {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ ØµØ­ÙŠØ­.');
            }
        }

        function clearApiKey() {
            localStorage.removeItem('gemini_api_key');
            document.getElementById('userApiKey').value = '';
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§ØµØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø¢Ù†.');
        }

        function toggleModal() {
            const body = document.querySelector('body');
            const modal = document.querySelector('.modal');
            modal.classList.toggle('opacity-0');
            modal.classList.toggle('pointer-events-none');
            body.classList.toggle('modal-active');
            
            // Fill input if key exists in storage (not default)
            const currentKey = localStorage.getItem('gemini_api_key');
            if(currentKey) {
                document.getElementById('userApiKey').value = currentKey;
            } else {
                document.getElementById('userApiKey').value = ''; // Don't show default key for security
            }
        }

        // --- Lesson Data ---
        const lessons = [
            {
                id: 1,
                title: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©",
                icon: "fa-toolbox",
                type: "lesson",
                content: `
                    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… ØªØµÙ…ÙŠÙ… Ù…Ø§Ø¨Ø§Øª FiveM</h2>
                    <p>Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹Ù„Ù… Ø£Ù† ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø§Ø¨Ø§Øª (Mapping) ÙŠÙ†Ù‚Ø³Ù… Ø¥Ù„Ù‰ Ù†ÙˆØ¹ÙŠÙ† Ø±Ø¦ÙŠØ³ÙŠÙŠÙ†:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="step-card border-l-4 border-blue-500">
                            <h4 class="font-bold text-blue-400">1. YMAP (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)</h4>
                            <p class="text-sm">Ù‡Ùˆ ÙˆØ¶Ø¹ Ù…Ø¬Ø³Ù…Ø§Øª (Props) Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£ØµÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŒ Ù…Ø«Ù„ Ø§Ù„Ø­ÙˆØ§Ø¬Ø²ØŒ Ø§Ù„Ø£Ø´Ø¬Ø§Ø±ØŒ ÙˆØ§Ù„ÙƒØ±Ø§Ø³ÙŠØŒ ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§ Ù„ØµÙ†Ø¹ Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯.</p>
                        </div>
                        <div class="step-card border-l-4 border-purple-500">
                            <h4 class="font-bold text-purple-400">2. MLO (Ø§Ù„Ù…ØªÙ‚Ø¯Ù…)</h4>
                            <p class="text-sm">Ù‡Ùˆ ØµÙ†Ø¹ Ù…Ø¨Ø§Ù†ÙŠ Ø¯Ø§Ø®Ù„ÙŠØ© (Interiors) ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ØŒ ÙˆÙŠØªØ·Ù„Ø¨ Ø¨Ø±Ø§Ù…Ø¬ ØªØµÙ…ÙŠÙ… Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù…Ø«Ù„ Blender Ø£Ùˆ 3ds Max.</p>
                        </div>
                    </div>
                    
                    <h3>Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙŠ Ø³ØªØ­ØªØ§Ø¬Ù‡Ø§ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ):</h3>
                    <ul class="list-disc pr-5">
                        <li><strong>CodeWalker:</strong> Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø°ÙŠ Ø³Ù†Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø©. Ù‡Ùˆ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙŠ ÙŠØªÙŠØ­ Ù„Ùƒ Ø±Ø¤ÙŠØ© Ø®Ø±ÙŠØ·Ø© GTA V ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.</li>
                        <li><strong>Ù†Ø³Ø®Ø© GTA V Ø£ØµÙ„ÙŠØ©:</strong> ÙŠØ­ØªØ§Ø¬ CodeWalker Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„ÙŠØ¹Ù…Ù„.</li>
                    </ul>
                `
            },
            {
                id: 2,
                title: "ØªØ«Ø¨ÙŠØª ÙˆØ¶Ø¨Ø· CodeWalker",
                icon: "fa-download",
                type: "lesson",
                content: `
                    <h2>Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØªØ¬Ù‡ÙŠØ² ÙˆØ±Ø´Ø© Ø§Ù„Ø¹Ù…Ù„</h2>
                    <p>Ø¨Ø¯ÙˆÙ† Ø¨Ø±Ù†Ø§Ù…Ø¬ CodeWalkerØŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø§Ø¨Ù†Ø¬. Ø¯Ø¹Ù†Ø§ Ù†Ø«Ø¨ØªÙ‡ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©.</p>
                    
                    <h3>Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ«Ø¨ÙŠØª:</h3>
                    <div class="space-y-4">
                        <div class="step-card">
                            <span class="font-bold text-yellow-500">1. Ø§Ù„ØªØ­Ù…ÙŠÙ„:</span>
                            <p>Ù‚Ù… Ø¨Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬ÙˆØ¬Ù„ Ø¹Ù† "CodeWalker GTA5 releases" ÙˆØ§Ø¯Ø®Ù„ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ GitHub. Ø­Ù…Ù„ Ø¢Ø®Ø± Ù†Ø³Ø®Ø© (ØªÙƒÙˆÙ† Ø¨ØµÙŠØºØ© zip).</p>
                        </div>
                        <div class="step-card">
                            <span class="font-bold text-yellow-500">2. ÙÙƒ Ø§Ù„Ø¶ØºØ·:</span>
                            <p>Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨ Ø¨Ø§Ø³Ù… "CodeWalker" ÙˆÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¯Ø§Ø®Ù„Ù‡.</p>
                        </div>
                        <div class="step-card">
                            <span class="font-bold text-yellow-500">3. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„:</span>
                            <p>Ø§ÙØªØ­ Ù…Ù„Ù <code>CodeWalker.exe</code>. Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ Ø³ÙŠØ·Ù„Ø¨ Ù…Ù†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø± Ù„Ø¹Ø¨Ø© GTA V. Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙŠ Ø«Ø¨ØªØª ÙÙŠÙ‡ Ø§Ù„Ù„Ø¹Ø¨Ø©.</p>
                        </div>
                    </div>
                `
            },
            {
                id: 3,
                title: "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„ØªØ­Ø±ÙŠÙƒ",
                icon: "fa-gamepad",
                type: "lesson",
                content: `
                    <h2>ÙƒÙŠÙ ØªØªØ­Ø±Ùƒ Ø¯Ø§Ø®Ù„ CodeWalkerØŸ</h2>
                    <p>Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø´Ø§Ø¨Ù‡ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø¹Ø¨Ø© Ù†ÙØ³Ù‡Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªØ·ÙˆÙŠØ±.</p>

                    <h3>Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… (Keyboard):</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="bg-gray-800 p-2 rounded">W, A, S, D</div>
                        <div class="bg-gray-800 p-2 rounded">Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø£Ù…Ø§Ù…ØŒ ÙŠØ³Ø§Ø±ØŒ Ø®Ù„ÙØŒ ÙŠÙ…ÙŠÙ†)</div>
                        
                        <div class="bg-gray-800 p-2 rounded">Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙŠÙ…Ù† Ù„Ù„ÙØ£Ø±Ø© (Hold)</div>
                        <div class="bg-gray-800 p-2 rounded">Ù„Ù„ØªÙˆØ¬ÙŠÙ‡ ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Ù†</div>
                        
                        <div class="bg-gray-800 p-2 rounded">T</div>
                        <div class="bg-gray-800 p-2 rounded">Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª (Toolbar) - Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹!</div>
                    </div>
                `
            },
            {
                id: 4,
                title: "Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹ (YMAP)",
                icon: "fa-hammer",
                type: "lesson",
                content: `
                    <h2>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ: ÙˆØ¶Ø¹ Ø­Ø§Ø¬Ø² Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚</h2>
                    <p>Ø³Ù†Ù‚ÙˆÙ… Ø§Ù„Ø¢Ù† Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù…Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØ¥Ø¶Ø§ÙØ© Ø­Ø§Ø¬Ø² Ø£Ù…Ù†ÙŠ Ø¨Ø³ÙŠØ·.</p>

                    <h3>1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (New Ymap):</h3>
                    <p>ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø¨Ø¹Ø¯ Ø¶ØºØ· T)ØŒ Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ <strong>Project</strong>:</p>
                    <ul class="list-disc pr-5 mb-4">
                        <li>Ø§Ø¶ØºØ· <strong>New</strong>.</li>
                        <li>Ø§Ø®ØªØ± <strong>Ymap File</strong>.</li>
                        <li>Ø³Ø¸Ù‡Ø± Ù„Ùƒ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ø³Ù… <code>map1.ymap</code> (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹).</li>
                    </ul>

                    <h3>2. Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ø³Ù… (Entity):</h3>
                    <p>Ø§Ù„Ø¢Ù†ØŒ ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø§Ø®ØªØ±Øª Ù…Ù„Ù Ø§Ù„Ù€ Ymap Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¸Ù„Ù„Ù‡ Ø¨Ø§Ù„Ø£Ø²Ø±Ù‚ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)ØŒ Ø«Ù…:</p>
                    <ul class="list-disc pr-5 mb-4">
                        <li>Ø§Ø°Ù‡Ø¨ Ù„ØªØ¨ÙˆÙŠØ¨ <strong>Ymap</strong>.</li>
                        <li>Ø§Ø¶ØºØ· <strong>New Entity</strong>.</li>
                        <li>Ø³ÙŠØ¸Ù‡Ø± Ù„Ùƒ "Ø¨ÙŠØ¶" Ø§ÙØªØ±Ø§Ø¶ÙŠ. ÙÙŠ Ø®Ø§Ù†Ø© <strong>Archetype</strong>ØŒ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡.</li>
                        <li>Ø¬Ø±Ø¨ ÙƒØªØ§Ø¨Ø©: <code>prop_barrier_work05</code> ÙˆØ§Ø¶ØºØ· Enter.</li>
                    </ul>
                `
            },
            {
                id: 5,
                title: "ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù…Ø§Ø¨ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±",
                icon: "fa-server",
                type: "lesson",
                content: `
                    <h2>Ù†Ù‚Ù„ Ø§Ù„Ø¹Ù…Ù„ Ø¥Ù„Ù‰ FiveM</h2>
                    <p>Ø§Ù„Ø¢Ù† Ù„Ø¯ÙŠÙƒ Ù…Ù„Ù <code>mymap.ymap</code>. ÙƒÙŠÙ Ù†Ø¬Ø¹Ù„Ù‡ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±ØŸ</p>

                    <h3>Ù‡ÙŠÙƒÙ„Ø© Ø§Ù„Ù…Ù„ÙØ§Øª (Folder Structure):</h3>
                    <div class="code-block">
mymap_folder/
â”œâ”€â”€ stream/
â”‚   â””â”€â”€ mymap.ymap  <-- Ù…Ù„ÙÙƒ ÙŠÙˆØ¶Ø¹ Ù‡Ù†Ø§
â””â”€â”€ fxmanifest.lua
                    </div>

                    <h3>Ù…Ù„Ù Ø§Ù„ØªØ¹Ø±ÙŠÙ (fxmanifest.lua):</h3>
                    <div class="code-block">
fx_version 'cerulean'
game 'gta5'
this_is_a_map 'yes'
files { 'stream/*.ymap' }
                    </div>
                `
            },
            {
                id: 6,
                title: "Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ø§Ø¨Ù†Ø¬",
                icon: "fa-magic",
                type: "ai-tool",
                content: ""
            }
        ];

        const navContainer = document.querySelector('nav');
        const contentArea = document.getElementById('contentArea');
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');

        // AI Tool HTML Content
        const aiToolHTML = `
            <h2><i class="fas fa-magic text-yellow-500 ml-2"></i>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ø§Ø¨Ù†Ø¬ âœ¨</h2>
            <p>Ù‡Ù„ ØªØ¨Ø­Ø« Ø¹Ù† Ø£Ø³Ù…Ø§Ø¡ Ù…Ø¬Ø³Ù…Ø§Øª (Props) Ø£Ùˆ Ø­Ù„ Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ Ø§Ø³Ø£Ù„ Ù‡Ù†Ø§.</p>
            
            <div class="grid grid-cols-1 gap-6 mt-6">
                <!-- Suggestion Mode -->
                <div class="step-card border-r-4 border-yellow-500">
                    <h3 class="font-bold text-yellow-400 mb-2">ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ø¬Ø³Ù…Ø§Øª ÙˆØ£ÙÙƒØ§Ø±</h3>
                    <p class="text-xs text-gray-400 mb-3">Ù…Ø«Ø§Ù„: "Ø¨Ø±ÙˆØ¨Ø³ Ù„Ù†Ù‚Ø·Ø© ØªÙØªÙŠØ´ Ø¹Ø³ÙƒØ±ÙŠØ©"</p>
                    <div class="flex flex-col gap-2">
                        <textarea id="aiPromptIdea" rows="2" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white focus:border-yellow-500 outline-none" placeholder="Ø§ÙƒØªØ¨ ÙÙƒØ±ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                        <button onclick="askGemini('idea')" class="sparkle-btn text-black font-bold py-2 px-4 rounded shadow-lg flex justify-center items-center">
                            <span id="btnTextIdea">âœ¨ Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ Ø£ÙÙƒØ§Ø±</span>
                        </button>
                    </div>
                </div>

                <!-- Troubleshoot Mode -->
                <div class="step-card border-r-4 border-blue-500">
                    <h3 class="font-bold text-blue-400 mb-2">ğŸ”§ Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…Ø§Ø¨Ù†Ø¬</h3>
                    <p class="text-xs text-gray-400 mb-3">Ù…Ø«Ø§Ù„: "Ø§Ù„Ù…Ø¬Ø³Ù… ÙŠØ®ØªÙÙŠ Ù„Ù…Ø§ Ø£Ø¨Ø¹Ø¯ Ø¹Ù†Ù‡"</p>
                    <div class="flex flex-col gap-2">
                        <textarea id="aiPromptFix" rows="2" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white focus:border-blue-500 outline-none" placeholder="Ø§Ø´Ø±Ø­ Ù…Ø´ÙƒÙ„ØªÙƒ..."></textarea>
                        <button onclick="askGemini('fix')" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded shadow-lg flex justify-center items-center transition">
                            <span id="btnTextFix">ğŸ› ï¸ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Output Area -->
            <div id="aiOutputContainer" class="hidden mt-6 animate-fade-in">
                <h3 class="text-gray-300 font-bold mb-2">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</h3>
                <div id="aiOutput" class="ai-response-area text-sm leading-relaxed text-gray-200"></div>
            </div>
        `;

        // Render Sidebar
        function renderNav() {
            navContainer.innerHTML = '';
            lessons.forEach((lesson, index) => {
                const btn = document.createElement('button');
                btn.className = `w-full text-right p-3 rounded-lg mb-1 transition-all duration-200 flex items-center ${index === 0 ? 'active-tab' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}`;
                const titleText = lesson.type === 'ai-tool' ? `${lesson.title} âœ¨` : lesson.title;
                const activeClass = lesson.type === 'ai-tool' ? 'text-yellow-400' : '';
                btn.innerHTML = `<i class="fas ${lesson.icon} w-8 text-center ml-2 ${activeClass}"></i> ${titleText}`;
                btn.onclick = () => loadLesson(index);
                navContainer.appendChild(btn);
            });
        }

        // Load Lesson
        function loadLesson(index) {
            const lesson = lessons[index];
            const buttons = navContainer.querySelectorAll('button');
            buttons.forEach(b => {
                b.className = 'w-full text-right p-3 rounded-lg mb-1 transition-all duration-200 flex items-center text-gray-300 hover:bg-gray-700 hover:text-white';
            });
            buttons[index].className = 'w-full text-right p-3 rounded-lg mb-1 transition-all duration-200 flex items-center active-tab shadow-lg transform scale-[1.02]';

            let mainContent = '';
            if (lesson.type === 'ai-tool') {
                mainContent = aiToolHTML;
            } else {
                mainContent = `
                    <div class="flex items-center mb-6 border-b border-gray-700 pb-4">
                        <div class="p-3 bg-yellow-500 rounded-full text-black ml-4">
                            <i class="fas ${lesson.icon} fa-2x"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-white">${lesson.title}</h1>
                    </div>
                    ${lesson.content}
                    <div class="mt-8 pt-6 border-t border-gray-700 flex justify-between">
                        ${index > 0 ? `<button onclick="loadLesson(${index - 1})" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>` : '<div></div>'}
                        ${index < lessons.length - 1 ? `<button onclick="loadLesson(${index + 1})" class="bg-yellow-500 hover:bg-yellow-400 text-black px-6 py-2 rounded font-bold">Ø§Ù„ØªØ§Ù„ÙŠ</button>` : ''}
                    </div>
                `;
            }

            contentArea.innerHTML = `<div class="lesson-content animate-fade-in">${mainContent}</div>`;
            if(window.innerWidth < 768) { sidebar.classList.add('translate-x-full'); }
        }

        // --- GEMINI API FUNCTION ---
        async function askGemini(type) {
            const currentApiKey = getApiKey();
            const outputDiv = document.getElementById('aiOutput');
            const outputContainer = document.getElementById('aiOutputContainer');

            if (!currentApiKey) {
                toggleModal(); // Open settings if no key
                return;
            }

            const promptInput = type === 'idea' ? document.getElementById('aiPromptIdea') : document.getElementById('aiPromptFix');
            const btnText = type === 'idea' ? document.getElementById('btnTextIdea') : document.getElementById('btnTextFix');
            const userQuery = promptInput.value.trim();

            if (!userQuery) return;

            // UI Loading
            const originalText = btnText.innerText;
            btnText.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±";
            btnText.classList.add('loading-dots');
            outputContainer.classList.remove('hidden');
            outputDiv.innerHTML = '<span class="text-gray-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini...</span>';

            const systemInstruction = `
                You are an expert FiveM Map Developer and CodeWalker user. 
                Answer in Arabic. Keep it technical but simple.
                If asked for props, list exact prop names (e.g. prop_barrier_work06).
                If asked for fixes, explain solutions for YMAP/MLO issues.
            `;

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${currentApiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Request Type: ${type}. Query: ${userQuery}` }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    }
                );

                if (!response.ok) {
                    const errorData = await response.json().catch(()=>({}));
                    throw new Error(errorData.error?.message || response.statusText);
                }

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                const formattedText = aiText.replace(/\*\*(.*?)\*\*/g, '<strong class="text-yellow-400">$1</strong>').replace(/\n/g, '<br>');
                outputDiv.innerHTML = formattedText;

            } catch (error) {
                console.error(error);
                let errorMsg = `Ø®Ø·Ø£: ${error.message}`;
                
                // Smart Error Handling for Leaked/Invalid Keys
                if (error.message.includes('API key') || error.message.includes('leaked') || error.message.includes('key not valid')) {
                    localStorage.removeItem('gemini_api_key'); // Clear bad key from storage
                    errorMsg = 'ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ø­Ø¸ÙˆØ±. ØªÙ… ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ØªØºÙŠÙŠØ±Ù‡.';
                    setTimeout(() => toggleModal(), 2000);
                }
                
                outputDiv.innerHTML = `<span class="text-red-400 font-bold">${errorMsg}</span>`;
            } finally {
                btnText.innerText = originalText;
                btnText.classList.remove('loading-dots');
            }
        }

        menuBtn.addEventListener('click', () => { sidebar.classList.toggle('translate-x-full'); });
        renderNav();
        loadLesson(0);
    </script>
</body>
    </html>
