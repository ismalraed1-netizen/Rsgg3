<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø¹Ù…Ø± | Ø¨Ø±Ù…Ø¬Ø© FiveM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                        },
                        brand: {
                            blue: '#3b82f6',
                            purple: '#8b5cf6',
                            green: '#10b981',
                        }
                    },
                    fontFamily: {
                        tajawal: ['Tajawal', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #0f172a; color: #f8fafc; overflow: hidden; }
        
        /* Code Block Styling */
        pre {
            background: #1e1e1e !important;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #334155;
            direction: ltr;
            text-align: left;
            overflow-x: auto;
            position: relative;
            margin: 1rem 0;
        }
        code { font-family: 'Consolas', monospace; color: #a5f3fc; font-size: 0.9rem; }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #334155;
            color: white;
            padding: 2px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.7;
            transition: 0.2s;
        }
        .copy-btn:hover { opacity: 1; background: #475569; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        
        /* Chat Bubbles */
        .chat-container { padding-bottom: 80px; } /* Space for input */
        .bubble { max-width: 85%; padding: 12px; border-radius: 16px; margin-bottom: 12px; font-size: 0.95rem; line-height: 1.5; position: relative; animation: slideUp 0.3s ease-out; }
        .bubble-user { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; align-self: flex-end; border-bottom-left-radius: 4px; }
        .bubble-ai { background: #1e293b; border: 1px solid #334155; color: #e2e8f0; align-self: flex-start; border-bottom-right-radius: 4px; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.2s;
            border: 1px solid #334155;
        }
        .quiz-option:hover {
            background-color: #334155;
        }
        .quiz-option.correct {
            background-color: #065f46; /* Green-900 */
            border-color: #10b981;
        }
        .quiz-option.wrong {
            background-color: #7f1d1d; /* Red-900 */
            border-color: #ef4444;
        }

        /* Mobile specific adjustments */
        .mobile-view-hidden { display: none; }
        .mobile-view-active { display: flex; flex-direction: column; height: 100%; }
        
        @media (min-width: 768px) {
            .mobile-view-hidden { display: flex; } /* Reset for desktop */
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col">

    <!-- Header (Responsive) -->
    <header class="bg-dark-800 border-b border-dark-700 h-16 flex items-center justify-between px-4 md:px-6 shrink-0 z-30 shadow-md">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-blue to-brand-purple flex items-center justify-center text-white shadow-lg shadow-blue-500/20">
                <i class="fas fa-code text-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg md:text-xl leading-tight">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø¹Ù…Ø±</h1>
                <p class="text-[10px] text-gray-400">ØªØ¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø© FiveM Ù…Ù† Ø§Ù„ØµÙØ±</p>
            </div>
        </div>
        
        <!-- Desktop: Status Indicator -->
        <div class="hidden md:flex items-center gap-2 bg-dark-900 px-3 py-1 rounded-full border border-dark-700">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-xs text-gray-300">Ø¹Ù…Ø± Ù…ØªØµÙ„</span>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex-1 flex overflow-hidden relative">
        
        <!-- 1. LESSONS LIST (Sidebar) - Desktop Only -->
        <aside class="hidden md:flex w-64 bg-dark-900 border-l border-dark-700 flex-col shrink-0">
            <div class="p-4 text-xs font-bold text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</div>
            <nav id="desktopLessonList" class="flex-1 overflow-y-auto px-2 space-y-1">
                <!-- Lessons injected via JS -->
            </nav>
            
            <!-- Idea Generator Button -->
            <div class="p-4 border-t border-dark-700">
                <button onclick="generateIdea()" class="w-full bg-dark-800 hover:bg-dark-700 text-brand-purple border border-dark-600 border-dashed rounded-lg p-3 text-sm font-bold flex items-center justify-center gap-2 transition group">
                    <i class="fas fa-lightbulb group-hover:text-yellow-400 transition-colors"></i> Ø§Ù‚ØªØ±Ø­ ÙÙƒØ±Ø© Ù…Ø´Ø±ÙˆØ¹
                </button>
            </div>
        </aside>

        <!-- 2. MAIN CONTENT (Lesson View) -->
        <main id="mainView" class="flex-1 bg-dark-900 overflow-y-auto relative w-full mobile-view-active">
            <div id="lessonContent" class="max-w-4xl mx-auto p-4 md:p-8 pb-24 md:pb-8">
                <!-- Content injected via JS -->
            </div>
            
            <!-- Quiz Container (Hidden by default) -->
            <div id="quizContainer" class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                <div class="bg-dark-800 w-full max-w-md rounded-2xl border border-dark-700 shadow-2xl overflow-hidden relative">
                    <button onclick="closeQuiz()" class="absolute top-4 left-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
                    <div class="p-6">
                        <div class="w-12 h-12 rounded-full bg-brand-purple/20 flex items-center justify-center mb-4 mx-auto">
                            <i class="fas fa-brain text-brand-purple text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-center mb-2">Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…Ùƒ</h3>
                        <p class="text-gray-400 text-xs text-center mb-6">Ø³Ø¤Ø§Ù„ Ø³Ø±ÙŠØ¹ Ù…ÙˆÙ„Ø¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¹Ù† Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        
                        <div id="quizContent" class="space-y-4">
                            <!-- Loading State -->
                            <div class="flex flex-col items-center py-8">
                                <i class="fas fa-circle-notch fa-spin text-3xl text-brand-blue mb-3"></i>
                                <span class="text-sm text-gray-400">Ø¹Ù…Ø± ÙŠÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 3. OMAR CHAT (Sidebar on Desktop, Full View on Mobile) -->
        <aside id="chatView" class="hidden md:flex md:w-96 bg-dark-800 border-r border-dark-700 flex-col absolute md:relative inset-0 z-20 md:z-auto">
            
            <!-- Chat Header (Mobile Only) -->
            <div class="md:hidden h-16 border-b border-dark-700 flex items-center px-4 bg-dark-800 shrink-0">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Omar&backgroundColor=b6e3f4" class="w-10 h-10 rounded-full border-2 border-brand-blue mr-3">
                <div>
                    <h3 class="font-bold">Ø§Ù„Ù…Ø¹Ù„Ù… Ø¹Ù…Ø±</h3>
                    <p class="text-xs text-brand-blue">Ø®Ø¨ÙŠØ± Ø¨Ø±Ù…Ø¬Ø© Lua</p>
                </div>
            </div>

            <!-- Messages Area -->
            <div id="chatHistory" class="flex-1 overflow-y-auto p-4 flex flex-col bg-dark-900/50 chat-container custom-scroll">
                <div class="bubble bubble-ai">
                    Ø­ÙŠØ§Ùƒ Ø§Ù„Ù„Ù‡ ÙŠØ§ Ø¨Ø·Ù„! ğŸ«¡ <br>
                    Ø£Ù†Ø§ Ø¹Ù…Ø±ØŒ Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø£ÙŠ Ø³Ø·Ø± ÙƒÙˆØ¯ Ù…Ø§ ÙÙ‡Ù…ØªÙ‡ØŒ Ø£Ùˆ Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Ùƒ Ø®Ø·Ø£ (Error) ÙŠØ±ÙØ¹ Ø§Ù„Ø¶ØºØ·.<br><br>
                    Ø¨Ø³ Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ø±Ø³Ù„Ù‡ Ù„ÙŠØŒ Ø£Ùˆ Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø³Ø¤Ø§Ù„ ÙÙŠ Ø¨Ø§Ù„Ùƒ!
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-3 bg-dark-800 border-t border-dark-700 shrink-0">
                <!-- Quick Suggestions -->
                <div class="flex gap-2 overflow-x-auto pb-3 mb-1 custom-scroll no-scrollbar">
                    <button onclick="setQuickMsg('ÙƒÙŠÙ Ø§Ø³ÙˆÙŠ Ø³ÙŠØ§Ø±Ø©ØŸ')" class="text-[10px] bg-dark-700 px-3 py-1.5 rounded-full text-gray-300 whitespace-nowrap border border-dark-600 hover:bg-dark-600 transition">ğŸš— ÙƒÙŠÙ Ø§Ø³ÙˆÙŠ Ø³ÙŠØ§Ø±Ø©ØŸ</button>
                    <button onclick="setQuickMsg('Ø§Ø´Ø±Ø­ Ù„ÙŠ Ø§Ù„ÙƒÙˆØ¯')" class="text-[10px] bg-dark-700 px-3 py-1.5 rounded-full text-gray-300 whitespace-nowrap border border-dark-600 hover:bg-dark-600 transition">ğŸ§ Ø§Ø´Ø±Ø­ Ù„ÙŠ Ø§Ù„ÙƒÙˆØ¯</button>
                    <button onclick="generateIdea()" class="text-[10px] bg-dark-700 px-3 py-1.5 rounded-full text-brand-purple whitespace-nowrap border border-brand-purple/30 hover:bg-brand-purple/10 transition"><i class="fas fa-lightbulb"></i> ÙÙƒØ±Ø© Ù…Ø´Ø±ÙˆØ¹</button>
                </div>

                <div class="flex gap-2 items-end">
                    <textarea id="userMsg" rows="1" class="flex-1 bg-dark-900 border border-dark-600 rounded-xl px-4 py-3 text-sm text-white focus:outline-none focus:border-brand-blue transition resize-none max-h-32" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." oninput="autoResize(this)" onkeypress="handleEnter(event)"></textarea>
                    <button onclick="sendMessage()" class="bg-brand-blue hover:bg-blue-600 text-white w-10 h-10 rounded-xl flex items-center justify-center transition shadow-lg shadow-blue-500/20 shrink-0">
                        <i class="fas fa-paper-plane text-sm"></i>
                    </button>
                </div>
            </div>
        </aside>

    </div>

    <!-- 4. BOTTOM NAVIGATION (Mobile Only) -->
    <nav class="md:hidden h-16 bg-dark-800 border-t border-dark-700 flex justify-around items-center shrink-0 z-40 pb-safe">
        <button onclick="switchTab('lessons')" id="tabLessons" class="flex flex-col items-center gap-1 text-brand-blue w-full h-full justify-center transition active:scale-95">
            <i class="fas fa-book-open text-xl mb-0.5"></i>
            <span class="text-[10px] font-medium">Ø§Ù„Ø¯Ø±ÙˆØ³</span>
        </button>
        
        <div class="w-px h-8 bg-dark-700"></div>

        <button onclick="switchTab('chat')" id="tabChat" class="flex flex-col items-center gap-1 text-gray-500 w-full h-full justify-center transition active:scale-95">
            <i class="fas fa-comment-alt text-xl mb-0.5 relative">
                <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-dark-800"></span>
            </i>
            <span class="text-[10px] font-medium">Ø§Ø³Ø£Ù„ Ø¹Ù…Ø±</span>
        </button>
    </nav>
    
    <!-- Lesson Selector Modal (Mobile) -->
    <div id="lessonModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-end md:hidden">
        <div class="bg-dark-800 w-full rounded-t-2xl max-h-[70vh] flex flex-col animate-[slideUp_0.3s_ease-out]">
            <div class="p-4 border-b border-dark-700 flex justify-between items-center">
                <h3 class="font-bold text-lg">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø³</h3>
                <button onclick="toggleLessonModal()" class="w-8 h-8 rounded-full bg-dark-700 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-2 overflow-y-auto" id="mobileLessonList">
                <!-- Mobile lessons injected here -->
            </div>
        </div>
    </div>

    <!-- Floating Lesson Button (Mobile Lesson View Only) -->
    <button id="floatingLessonBtn" onclick="toggleLessonModal()" class="md:hidden fixed bottom-20 left-4 bg-dark-800 border border-dark-600 text-white px-4 py-2 rounded-full shadow-xl z-30 flex items-center gap-2 text-sm font-bold backdrop-blur">
        <i class="fas fa-list-ul text-brand-blue"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³
    </button>

    <script>
        // --- Data ---
        const lessons = [
            {
                id: 1,
                title: "1. Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©: ÙˆØ´ Ù‡ÙŠ ÙØ§ÙŠÙ Ø§Ù…ØŸ",
                content: `
                    <h1 class="text-3xl font-bold text-blue-400 mb-4">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø·Ø±ÙŠÙ‚ ğŸš€</h1>
                    <p class="text-gray-300 mb-4 leading-relaxed">
                        Ø­ÙŠØ§Ùƒ Ø§Ù„Ù„Ù‡ ÙŠØ§ ÙˆØ­Ø´! ØªØ¨ÙŠ ØªØµÙŠØ± Ù…Ø¨Ø±Ù…Ø¬ ÙÙŠ ÙØ§ÙŠÙ Ø§Ù…ØŸ ÙˆØµÙ„Øª Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­.
                        <br>
                        <strong>FiveM</strong> Ø¨Ø§Ø®ØªØµØ§Ø± Ù‡Ùˆ Ù…Ù†ØµØ© ØªØ³Ù…Ø­ Ù„Ùƒ ØªØ¹Ø¯Ù„ Ø¹Ù„Ù‰ GTA V ÙˆØªØ¶ÙŠÙ Ø³ÙŠØ§Ø±Ø§ØªØŒ Ù…Ù„Ø§Ø¨Ø³ØŒ ÙˆØ£Ù†Ø¸Ù…Ø© Ù„Ø¹Ø¨ ÙƒØ§Ù…Ù„Ø© (Roleplay).
                    </p>
                    <div class="bg-dark-800 p-4 rounded-xl border border-dark-700 mb-6">
                        <h3 class="font-bold text-white mb-2 flex items-center gap-2"><i class="fas fa-info-circle text-blue-500"></i> Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¹Ø§Ù„Ø·Ø§ÙŠØ±</h3>
                        <p class="text-sm text-gray-400">Ù„ØºØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù„ÙŠ Ø¨Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù‡ÙŠ <strong>Lua</strong>. Ù„ØºØ© Ø®ÙÙŠÙØ© ÙˆØ³Ù‡Ù„Ø© Ø¬Ø¯Ø§Ù‹ØŒ ÙŠØ¹Ù†ÙŠ Ù„Ø§ ØªØ´ÙŠÙ„ Ù‡Ù… Ø§Ù„ØªØ¹Ù‚ÙŠØ¯.</p>
                    </div>
                `
            },
            {
                id: 2,
                title: "2. Ø´Ø±Ø­ Ù…Ù„Ù fxmanifest.lua",
                content: `
                    <h1 class="text-2xl font-bold text-blue-400 mb-4">Ù‡ÙˆÙŠØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª ğŸ†”</h1>
                    <p class="text-gray-300 mb-4">
                        Ø£ÙŠ Ø³ÙƒØ±Ø¨Øª ØªØ³ÙˆÙŠÙ‡ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù„Ù‡ "Ø¨Ø·Ø§Ù‚Ø© ØªØ¹Ø±ÙŠÙ" Ø¹Ø´Ø§Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡. Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø§Ø³Ù…Ù‡ <code>fxmanifest.lua</code>.
                    </p>
                    <p class="text-sm text-gray-400 mb-2">Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ù‡Ø°Ø§ ÙˆØ­Ø·Ù‡ ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</p>
                    <div class="relative">
                        <pre><code>fx_version 'cerulean'
game 'gta5'

description 'My First Script'
version '1.0.0'

client_script 'client.lua'
server_script 'server.lua'</code><button class="copy-btn" onclick="copyCode(this)">Ù†Ø³Ø®</button></pre>
                    </div>
                `
            },
            {
                id: 3,
                title: "3. ÙƒÙŠÙ ØªØ·Ø¨Ø¹ Ø±Ø³Ø§Ù„Ø© (Print)",
                content: `
                    <h1 class="text-2xl font-bold text-blue-400 mb-4">Ø£ÙˆÙ„ ÙƒÙˆØ¯ Ù„Ùƒ ğŸ’»</h1>
                    <p class="text-gray-300 mb-4">
                        Ø¹Ø´Ø§Ù† Ù†ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø´ØºØ§Ù„ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©. Ù‡Ø°ÙŠ ØªØ·Ø¨Ø¹ ÙƒÙ„Ø§Ù… ÙÙŠ ÙƒÙˆÙ†Ø³ÙˆÙ„ F8 Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©.
                    </p>
                    <div class="relative">
                        <pre><code>print('ÙŠØ§ Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡! Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ø´ØªØºÙ„ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰')

-- Ø£Ù…Ø± ØªØ±Ø­ÙŠØ¨ÙŠ
RegisterCommand('hi', function()
    print('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±!')
end, false)</code><button class="copy-btn" onclick="copyCode(this)">Ù†Ø³Ø®</button></pre>
                    </div>
                    <p class="text-sm text-gray-400 mt-4">Ø¬Ø±Ø¨ ØªØ¯Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ¶ØºØ· F8 ÙˆØªÙƒØªØ¨ <code>hi</code> ÙˆØ´Ù ÙˆØ´ ÙŠØ·Ù„Ø¹ Ù„Ùƒ!</p>
                `
            },
            {
                id: 4,
                title: "4. ØµÙ†Ø§Ø¹Ø© Ø³ÙŠØ§Ø±Ø© (Native)",
                content: `
                    <h1 class="text-2xl font-bold text-blue-400 mb-4">ÙƒÙŠÙ ØªØ±Ø³Ø¨Ù† Ø³ÙŠØ§Ø±Ø©ØŸ ğŸš—</h1>
                    <p class="text-gray-300 mb-4">
                        Ù†Ø³ØªØ®Ø¯Ù… Ø´ÙŠ Ø§Ø³Ù…Ù‡ <strong>Natives</strong> (Ø£ÙˆØ§Ù…Ø± Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©).
                    </p>
                    <div class="relative">
                        <pre><code>RegisterCommand('car', function(source, args)
    local vehicleName = args[1] or 'adder'
    
    -- Ø·Ù„Ø¨ Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    RequestModel(vehicleName)
    while not HasModelLoaded(vehicleName) do
        Wait(10)
    end

    -- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    local ped = PlayerPedId()
    local pos = GetEntityCoords(ped)
    local veh = CreateVehicle(vehicleName, pos.x, pos.y, pos.z, GetEntityHeading(ped), true, false)
    
    -- Ø±ÙƒÙˆØ¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
    SetPedIntoVehicle(ped, veh, -1)
    
    print('Ù…Ø¨Ø±ÙˆÙƒ Ø§Ù„Ù…ÙˆØªØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯! ğŸ˜')
end, false)</code><button class="copy-btn" onclick="copyCode(this)">Ù†Ø³Ø®</button></pre>
                    </div>
                `
            }
        ];

        // --- Logic ---
        let currentLessonId = 1;
        const apiKey = "AIzaSyDIZ-c5Br5QSoT3W8LGGy2d5-oISvjyD2w";

        function init() {
            renderLessonList();
            loadLesson(1);
        }

        // Render Lessons for both Desktop Sidebar and Mobile Modal
        function renderLessonList() {
            const desktopList = document.getElementById('desktopLessonList');
            const mobileList = document.getElementById('mobileLessonList');
            
            lessons.forEach(lesson => {
                // Desktop Item
                const dBtn = document.createElement('button');
                dBtn.className = `w-full text-right px-3 py-3 rounded-lg text-sm mb-1 transition flex items-center gap-3 hover:bg-dark-800 ${lesson.id === 1 ? 'bg-dark-800 text-brand-blue font-bold' : 'text-gray-400'}`;
                dBtn.id = `d-lesson-${lesson.id}`;
                dBtn.innerHTML = `<i class="fas ${getIcon(lesson.id)} w-5 text-center"></i> ${lesson.title}`;
                dBtn.onclick = () => loadLesson(lesson.id);
                desktopList.appendChild(dBtn);

                // Mobile Item
                const mBtn = document.createElement('button');
                mBtn.className = "w-full text-right p-4 border-b border-dark-700 text-gray-200 active:bg-dark-700 flex items-center gap-3";
                mBtn.innerHTML = `<i class="fas ${getIcon(lesson.id)} text-brand-blue"></i> ${lesson.title}`;
                mBtn.onclick = () => { loadLesson(lesson.id); toggleLessonModal(); };
                mobileList.appendChild(mBtn);
            });
        }

        function getIcon(id) {
            const icons = ['fa-flag', 'fa-file-code', 'fa-terminal', 'fa-car'];
            return icons[id-1] || 'fa-book';
        }

        function loadLesson(id) {
            currentLessonId = id;
            const lesson = lessons.find(l => l.id === id);
            
            // Render Content
            const container = document.getElementById('lessonContent');
            
            // Append Quiz Button
            const quizBtnHTML = `
                <div class="mt-8 pt-8 border-t border-dark-700">
                    <button onclick="startQuiz('${lesson.title}')" class="w-full bg-gradient-to-r from-brand-purple to-brand-blue p-4 rounded-xl shadow-lg flex items-center justify-center gap-2 hover:opacity-90 transition font-bold text-white">
                        <i class="fas fa-brain"></i> Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…Ùƒ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³
                    </button>
                </div>
            `;
            
            container.innerHTML = `<div class="animate-[slideUp_0.4s_ease-out]">${lesson.content}${quizBtnHTML}</div>`;

            // Highlight Desktop Sidebar
            document.querySelectorAll('#desktopLessonList button').forEach(b => {
                b.className = 'w-full text-right px-3 py-3 rounded-lg text-sm mb-1 transition flex items-center gap-3 hover:bg-dark-800 text-gray-400';
            });
            const activeBtn = document.getElementById(`d-lesson-${id}`);
            if(activeBtn) activeBtn.className = 'w-full text-right px-3 py-3 rounded-lg text-sm mb-1 transition flex items-center gap-3 bg-dark-800 text-brand-blue font-bold shadow-sm';

            // Scroll to top
            document.getElementById('mainView').scrollTop = 0;
        }

        // --- Mobile Tabs Logic ---
        function switchTab(tab) {
            const mainView = document.getElementById('mainView');
            const chatView = document.getElementById('chatView');
            const tabLessons = document.getElementById('tabLessons');
            const tabChat = document.getElementById('tabChat');
            const floatBtn = document.getElementById('floatingLessonBtn');

            if (tab === 'lessons') {
                mainView.classList.remove('hidden');
                chatView.classList.add('hidden');
                
                // Styling
                tabLessons.classList.add('text-brand-blue');
                tabLessons.classList.remove('text-gray-500');
                tabChat.classList.add('text-gray-500');
                tabChat.classList.remove('text-brand-blue');
                
                // Show Floating Button
                floatBtn.classList.remove('hidden');
            } else {
                mainView.classList.add('hidden');
                chatView.classList.remove('hidden');
                chatView.classList.add('flex'); // Ensure flex is added back

                // Styling
                tabChat.classList.add('text-brand-blue');
                tabChat.classList.remove('text-gray-500');
                tabLessons.classList.add('text-gray-500');
                tabLessons.classList.remove('text-brand-blue');

                // Hide Floating Button
                floatBtn.classList.add('hidden');
            }
        }

        function toggleLessonModal() {
            const modal = document.getElementById('lessonModal');
            modal.classList.toggle('hidden');
        }

        // --- Chat Logic ---
        let isTyping = false;

        function setQuickMsg(msg) {
            document.getElementById('userMsg').value = msg;
            autoResize(document.getElementById('userMsg'));
            sendMessage();
        }

        function autoResize(el) {
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        function handleEnter(e) {
            if(e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        async function sendMessage() {
            if(isTyping) return;
            const input = document.getElementById('userMsg');
            const text = input.value.trim();
            if(!text) return;

            // Add User Message
            addBubble(text, 'user');
            input.value = '';
            input.style.height = 'auto'; // Reset height

            // AI Logic
            isTyping = true;
            const typingId = addTypingIndicator();

            try {
                const response = await callGemini(text);
                removeBubble(typingId);
                addBubble(response, 'ai');
            } catch (error) {
                removeBubble(typingId);
                addBubble("Ù…Ø¹Ù„ÙŠØ´ ÙŠØ§ ØºØ§Ù„ÙŠØŒ ØµØ§Ø± Ø¹Ù†Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ ğŸ”Œ. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.", 'ai');
            } finally {
                isTyping = false;
            }
        }

        function addBubble(text, type) {
            const div = document.createElement('div');
            div.className = `bubble bubble-${type}`;
            
            if(type === 'ai') {
                // Parse markdown
                div.innerHTML = marked.parse(text);
                // Re-apply copy buttons to new code blocks
                setTimeout(() => {
                    div.querySelectorAll('pre code').forEach(block => {
                        const pre = block.parentElement;
                        if (!pre.querySelector('.copy-btn')) {
                            const btn = document.createElement('button');
                            btn.className = 'copy-btn';
                            btn.innerText = 'Ù†Ø³Ø®';
                            btn.onclick = function() { copyCode(this); };
                            pre.appendChild(btn);
                        }
                    });
                }, 100);
            } else {
                div.innerText = text;
            }

            document.getElementById('chatHistory').appendChild(div);
            scrollToBottom();
            return div;
        }

        function addTypingIndicator() {
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'bubble bubble-ai text-gray-500 text-xs italic';
            div.innerText = 'Ø¹Ù…Ø± Ù‚Ø§Ø¹Ø¯ ÙŠÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯...';
            document.getElementById('chatHistory').appendChild(div);
            scrollToBottom();
            return id;
        }

        function removeBubble(id) {
            const el = document.getElementById(id);
            if(el) el.remove();
        }

        function scrollToBottom() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function copyCode(btn) {
            const code = btn.previousElementSibling.innerText;
            navigator.clipboard.writeText(code);
            const originalText = btn.innerText;
            btn.innerText = "ØªÙ… Ø§Ù„Ù†Ø³Ø®!";
            setTimeout(() => btn.innerText = originalText, 2000);
        }

        // --- NEW FEATURES: Quiz & Ideas ---

        function generateIdea() {
            switchTab('chat');
            setQuickMsg('Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ ÙÙƒØ±Ø© Ù…Ø´Ø±ÙˆØ¹ Ø³ÙƒØ±Ø¨Øª Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ† Ù…Ø¹ Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø­Ù‚Ù‡.');
        }

        async function startQuiz(lessonTitle) {
            const container = document.getElementById('quizContainer');
            const content = document.getElementById('quizContent');
            container.classList.remove('hidden');
            
            content.innerHTML = `
                <div class="flex flex-col items-center py-8">
                    <i class="fas fa-circle-notch fa-spin text-3xl text-brand-blue mb-3"></i>
                    <span class="text-sm text-gray-400">Ø¹Ù…Ø± ÙŠÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¹Ù† "${lessonTitle}"...</span>
                </div>
            `;

            try {
                // Prompt Gemini for JSON
                const prompt = `
                    Generate a multiple-choice question in Arabic about the FiveM coding topic: "${lessonTitle}".
                    Format: JSON object with keys: "question" (string), "options" (array of 4 strings), "correctIndex" (0-3 number).
                    Ensure the output is valid JSON only.
                `;
                
                const responseText = await callGemini(prompt, true); // true = raw text requested, we handle parsing
                
                // Extract JSON from response (remove markdown fences if any)
                const jsonStr = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                const quizData = JSON.parse(jsonStr);

                renderQuiz(quizData);

            } catch (e) {
                console.error(e);
                content.innerHTML = `<div class="text-red-400 text-center">ØµØ§Ø± Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³Ø¤Ø§Ù„. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.</div>`;
            }
        }

        function renderQuiz(data) {
            const content = document.getElementById('quizContent');
            let optionsHTML = '';
            
            data.options.forEach((opt, idx) => {
                optionsHTML += `
                    <button onclick="checkAnswer(this, ${idx}, ${data.correctIndex})" class="quiz-option w-full text-right p-3 rounded-lg bg-dark-700 text-sm mb-2">
                        ${opt}
                    </button>
                `;
            });

            content.innerHTML = `
                <div class="text-white font-bold mb-4 text-lg leading-relaxed">${data.question}</div>
                <div class="space-y-2">${optionsHTML}</div>
                <div id="quizResult" class="mt-4 text-center font-bold h-6"></div>
            `;
        }

        function checkAnswer(btn, selectedIdx, correctIdx) {
            const resultDiv = document.getElementById('quizResult');
            const allBtns = document.querySelectorAll('.quiz-option');
            
            // Disable all buttons
            allBtns.forEach(b => b.disabled = true);

            if (selectedIdx === correctIdx) {
                btn.classList.add('correct');
                resultDiv.innerHTML = '<span class="text-green-400">ÙƒÙÙˆ! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ğŸ‰</span>';
            } else {
                btn.classList.add('wrong');
                allBtns[correctIdx].classList.add('correct'); // Show correct one
                resultDiv.innerHTML = '<span class="text-red-400">Ù„Ù„Ø£Ø³Ù Ø®Ø·Ø£ØŒ Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­ Ù‡Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ù„Ø£Ø®Ø¶Ø± ğŸ˜…</span>';
            }
        }

        function closeQuiz() {
            document.getElementById('quizContainer').classList.add('hidden');
        }

        // --- GEMINI CORE ---

        async function callGemini(prompt, isJsonMode = false) {
            const systemPrompt = isJsonMode ? 
                `You are a JSON generator. Respond ONLY with valid JSON. No markdown.` :
                `
                Ø£Ù†Øª "Ø¹Ù…Ø±"ØŒ Ù…Ø¨Ø±Ù…Ø¬ Ø®Ø¨ÙŠØ± ÙÙŠ FiveM ÙˆÙ…Ø¹Ù„Ù… Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†.
                Ù„ØºØªÙƒ: Ø¹Ø±Ø¨ÙŠØ© (Ù„Ù‡Ø¬Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©/Ø®Ù„ÙŠØ¬ÙŠØ© ÙˆØ¯ÙŠØ©).
                Ù…Ù‡Ù…ØªÙƒ: ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø±Ù…Ø¬Ø© Lua Ù„Ù€ FiveM.
                Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±Ø¯:
                1. Ø§Ø´Ø±Ø­ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø¨Ø¨Ø³Ø§Ø·Ø©.
                2. Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙˆØ¯ØŒ Ø¶Ø¹Ù‡ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¯Ø§Ø®Ù„ Markdown Code Block.
                3. ÙƒÙ† Ù…Ø´Ø¬Ø¹Ø§Ù‹ ÙˆÙ…Ø±Ø­Ø§Ù‹.
            `;

            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: isJsonMode ? { responseMimeType: "application/json" } : {}
                    })
                }
            );

            if(!response.ok) throw new Error("API Error");
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Init
        init();

    </script>
</body>
    </html>
